---
title: 'TEMPEST: Understory plant community responses to coastal flooding'
author: "Zachary Bunch"
date: "3/19/2023"
output:
  pdf_document: default
  html_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(root.dir= '/tmp')
library(tidyverse)

```
## Set up
Load tidyverse and setup R.

## Background

Destructive weather phenomenons are becoming more commonplace as global climate change intensifies. Researchers at the Smithsonian designed an experiment to investigates how heavy flooding or rapid downpours impact forest ecosystems. The experiment will emulate forest flooding from both fresh and salt water disruptions. 

Three plots were used to explore the impact of flooding on the under story community. Prior to experimentation, the species cover for each plot was determined, allowing for a point of caparison. Experimental observations were taken as approximate percent cover within a small subplot. The three large plots were 40 x 50 m (C, F and S) with each containing 16 subplots. A special "additional" subplot was created for species found but not sampled.  

```
TEMPEST <- read.csv("TEMPEST_SERC_understory sppcomp_2021.csv")


# Select only rows of the data frame that correspond to plant species
is_plant <- !grepl("infrastructure|cover", TEMPEST$species)

# Subset the data frame using the is_plant vector
plant_species <- TEMPEST[is_plant, "species", drop = FALSE]

# Remove duplicate species names
plant_species <- unique(plant_species)

# Subset the TEMPEST data frame to only include treatment columns
treatment_info <- TEMPEST[, c("project_name", "calendar_year", "treatment_year", "season", "plot", "subplot")]

# Create a new column for replicate
treatment_info$replicate <- paste(treatment_info$plot, treatment_info$subplot, sep = "_")

# Create a new column for verbalized plot treatment
treatment_info$treatment <- ifelse(TEMPEST$plot == "C", "C", 
                                    ifelse(TEMPEST$plot == "S", "S",
                                           ifelse(TEMPEST$plot == "F", "F", NA)))

# Remove the plot and subplot columns
treatment_info$plot <- treatment_info$subplot <- NULL


```
# Code Chunk 1.1
Reads in the TEMPEST_SERC_understory sppcomp_2021.csv file into the variable TEMPEST. !Grepl select the correct data frames and those dataframes are then subsetted from the TEMPEST dataframe. We than utilize the unique functiont to ensure that we only have unique values. The paste fucnction is utilized to combine plot and subset into a new column called replicate. Additionally, a new column also created called treatment that utilizs a ifelse statement to extract treatment information from the appropritely labeled column in TEMPEST. Finally, the plot and subplot column are removed for simplicity. 



```
library(dplyr)

# Select only rows of the data frame that correspond to plant species
is_plant <- !grepl("infrastructure|cover", TEMPEST$species)

# Subset the data frame using the is_plant vector
TEMPEST_plants <- TEMPEST[is_plant, ]

# Remove rows with "additional" in subplot column
TEMPEST_plants <- TEMPEST_plants %>% filter(!grepl("additional", subplot))

# Calculate total herbaceous plant cover for each subplot
total_cover <- TEMPEST_plants %>%
  group_by(subplot) %>%
  summarize(total_cover = sum(cover))

# Join total_cover data frame back to the original data frame
TEMPEST_cover <- TEMPEST_plants %>% left_join(total_cover, by = "subplot")

# Calculate relative cover for each species
TEMPEST_cover <- TEMPEST_cover %>%
  mutate(relative_cover = 100 * cover / total_cover)


```

## Code Chunk 1.2

We are once again using our is_plant variable to get only plant values (not infrastructure or cover). We then use the is_plant variable to select only the rows of data containing real plants. We then utilize grelph to remove the "additional" subplot from the subplot column. We than use a group_by statement to group by subplot and sum the cover data for each subplot. Then, we join the total_cover back to TEMPEST_plants are store in it TEMPEST_cover. Finally, we clean a column storing calculating and storing the relative cover in the TEMPEST_cover variable. 

```
#Richness 

subplot_species_richness <- TEMPEST_plants %>%
  group_by(subplot) %>%
  summarize(species_richness = n_distinct(species))


#Richness mean and standrad error

plot_species_richness <- subplot_species_richness %>%
  group_by(plot) %>%
  summarize(mean_species_richness = mean(species_richness),
            se_species_richness = sd(species_richness) / sqrt(n()))
            
            
plot_species_richness_all <- TEMPEST_plants %>%
  group_by(plot) %>%
  summarize(species_richness = n_distinct(species, na.rm = TRUE))            
  
  
```

## Code Chunk 1.3

subplot_species_richness is created by calling TEMPEST_plants, grouping by subplot and utilizing the summarize function to store n_distict (number of unique species) in a column called species_richness. 

plot_species_richness calls the subplot_species_richness variable and groups by plot. Then, we use the summarize function to calculate the mean of species_richness as well as the standrd error. 

Lastly, we create plot_species_richness_all by calling the TEMPEST_plants variable, grouping by plot, using summarize to determine n_distinct for the number of species (species richness).

```
#Bar graph

subplot_plot_richness <- plot_species_richness %>%
  ggplot(aes(x = plot, y = mean_species_richness)) +
  geom_bar(stat = "identity", fill = "lightblue") +
  geom_errorbar(aes(ymin = mean_species_richness - se_species_richness, ymax = mean_species_richness +     se_species_richness), width = 0.4) +
  ggtitle("Mean subplot species richness per plot") +
  xlab("Plot") + ylab("Mean species richness")
  
plot(subplot_plot_richness)

  
plot_richness_plot <- ggplot(plot_species_richness_all, aes(x = plot, y = species_richness)) +
  geom_bar(stat = "identity", fill = "steelblue", alpha = 0.8) +
  labs(title = "Richness at the plot level", x = "Plot", y = "Richness")

plot(plot_richness_plot)
  
```
## Code Chunk 1.4

First graph displays richness per plot using mean of subplots. Made using a ggplot function and stored in subplot_plot_richness. Second graph displays richness at the plot level. Also uses ggplot funciton and stores output in the varible plot_richness_plot. 

## R Markdown

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:

```{r cars}
summary(cars)
```

## Including Plots

You can also embed plots, for example:

```{r pressure, echo=FALSE}
plot(pressure)
```

Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.
