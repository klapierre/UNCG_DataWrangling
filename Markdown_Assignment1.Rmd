---
title: "Comparing soil nutrients between an annual burned and patch burn grazing system"
author: "William Eichhorn"
date: "2023-03-13"
output: pdf_document
---
```{r, setup, include=FALSE}
knitr::opts_knit$set(root.dir = '~/UNCG_DataWrangling')
```

# BACKGROUND

### Annual burning and grazing

Homogeneity of the environment due to the production and management of cattle can be detrimental to the conservation of wildlife and plant populations in the surrounding area of agricultural systems. 
Annual burning and grazing (AGB) is a management system frequently employed to boost productivity in cattle, but this comes with severe deficits to the environment via the removal of necessary detritus and flora biodiversity. 

### Patch burn grazing
An alternative management strategy known at Patch burn grazing (PBG) strikes a balance between a robust, healthy, and diverse ecosystem and allowing cattle farmers to maintain their herds' diets and well-being. PBG creates a flowing, heterogeneous landscape by shifting herds from unburned patches to recently burned areas to forage. These areas change and shift throughout the year to produce a fluid mosaic of ecosystems.
PBG has many benefits for biodiversity, ecosystem function, and agricultural sustainability. However, the effects on belowground processes is largely undocumented.

### Experimental design

Several resin bags were buried across an agricultural landscape to document the found effects of ABG vs. PBG on the soul nitrate (NO3), ammonium (NH4), and phosphorus (P) deposition from May-August 2021. KCl was used to extract the NO3 and NH4, HCl was used to extract P. The resin extracts were analyzed to determine the total composition of each variable within samples. 

-------------
-------------

# TASK 1
### Let's get this party started


In this first task, I am going to load in the tidyverse library and set up the theme. This allows me to play with the data and tidy it up, because researchers get messy with data collection!

```{r, library, message=FALSE, warning=FALSE}
library(tidyverse)
theme_set(theme_dark())
```

-------------
-------------

# Task 2
### Bring in the DATA! *triumphant fan fare*

I'm going to load in our data sets
```{r, read.csv}
PBG_N <- read.csv('PBG_N_compiled_raw_2021.csv')
PBG_P <- read.csv('PBG_P_compiled_raw_2021.csv')
PBG_trts <- read.csv('PBG_trts.csv')
```

-------------
-------------

# Task 3
### In a bind

For this task, we are going to combine the rows from both of our dataframes, and filter down to only keep the data in the "sample"
column which contains any data which begins with "U" using the grepl() function in dplyr.

```{r, rbind, filter}
PBG_Combine <-rbind(PBG_N,PBG_P)%>%
  filter(grepl("U", sample))
```


-------------
-------------

# Task 4 
### Out of the pan and into the R Markdown fire

Now things are going to get a little dicey. I need to join the data sets with our transect data. 
To do this, we first need to filter the maximum dilution of our Sample column. Then we will parse our
Sample column into four new columns, one of which we will no longer need (element)

```{r, group_by, filter, warning=FALSE}
PBG_Filter<- PBG_Combine %>% 
  group_by(Sample) %>% 
  filter(dilution == max(dilution, na.rm = TRUE)) %>% 
  separate(col = Sample, into = c('watershed', 'transect', 'plot', 'element'), sep = '-')%>%
  select(-element)%>%
  ungroup()

```
Then we will bring in the data from our transects by the new columns we created in our previous chunk.
We will also clean up and rename the tests used to make them more accessible to read.

```{r}
PBG_Merge <- merge(PBG_Filter,PBG_trts, by=c("watershed","transect","plot"),all.x=T)%>%
  mutate(test = ifelse(test=="HCl PO4_1",
    "Phosphate",ifelse(test=="KCL NO3_NO2 2", "Nitrate", "Ammonia")))
```



# Task 5

### Graphic design is my passion

Here we have to create a boxplot to contrast and compare the concentration of Ammonia, Nitrate, and Phosphate per treatement across the study

```{r}
ggplot(PBG_Merge, aes(x=as.factor(treatment),y=as.numeric(concentration), fill=as.factor(treatment)))+
  geom_boxplot()+
 facet_wrap(facets=~test,scales="free_y")+
  xlab("Treatment")+
  ylab("Concentration")+
  scale_fill_manual(values=c("#1AFF1A","#006CD1"))
 

```


# Task 6

### This totally didn't take me a full day to figure out

Now we have to calculate the concentration coefficient for each nutrient type by test.
To do this, we will first find the mean and standard deviation, then create a new column containing the end product of mean/sd


```{r, message=FALSE}
PBG_Variation <- PBG_Merge %>%
  group_by(treatment,test) %>%
  summarise(conc_mean=mean(as.numeric(concentration)),conc_sd=sd(concentration))%>%
  mutate(conc_coeff=conc_mean/conc_sd)
```

# Task 7
### THE FINAL TASK!
#### .... for now


Finally, we just need to plot the concentration coefficient by the tests for each nutrient to see which treatment plan yielded the best results.

```{r}

ggplot(PBG_Variation, aes(x=test,y=as.numeric(conc_coeff), fill=as.factor(treatment)))+
  geom_bar(stat="identity", position="dodge", )+
  xlab("Nutrients")+
  ylab("Concentration Coefficient")+
  scale_fill_manual(values=c("#1AFF1A","#006CD1"))
```


# Conclusion

Based upon the results generated, overall it appears that the PBG treatment plan yields a higher amount of nutrients within the soil. Although the difference in Nitrate yield seems to be negligible. 