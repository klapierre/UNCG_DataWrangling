---
title: "Initial Visual Analysis of *Scuirus carolinensis* Occerrences Derived from VertNet"
author: "Leo Ivey"
date: "`r Sys.Date()`"
output:
  html_document:
    df_print: paged
urlcolor: blue
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Project Overview
## Background Information

The dataset I am using consists of ~8500 *Scuirus carolinensis* (Eastern Grey Squirrel) observations that have been georeferenced, from the 1800s to 2017. These occurrences are exclusively from North America, and I am only using the observations that are occuring west of the Mississippi River for this particular project. This dataset is part of a larger project aimed at quantifying the impacts that anthropogenic influences have on the geographic distribution of squirrel species - which are often in very close contact with humans and urban/suburban environments, and have been noted to follow humans into areas where their presence would not normally be expected based on the landscape's ecology.

This particular dataset is exclusively from **VertNet**, but will later be incorporated into a larger dataset including citizen science observations of the same species from **iNaturalist** as well as other published datasets. Projections will be completed in **Maxent**, and then visualized in **QGIS**, in order to prepare this dataset for that work all observations must be isolated to keep the relevant information (latitude and longitude, date of observation, and location broken down to state level).

## Cleaning and Workflow

To clean this dataset, I first needed to isolate only the relevant columns from my original dataset. Since column *"West?"* contains the ? character, it needs to be removed separately by selecting the column location (in this case, the first column and first row, or [1,1]). This column will be re-introduced later, but contains a very significant number of NAs and is subset to a specific range of occurrences for a separate project, so we need to reclassify the information regardless (otherwise we would have ~300 rows, instead of ~3500).

Before anything else, though, let's go ahead and set up our environment.
\
```{r, load_package, message=FALSE, warning=FALSE}
library(tidyverse)
library(dplyr)
SciurusCarolinensisVertNet_SciurusCarolinensisVertNet <- read.csv(file =                                       "C:\\Users\\leoiv\\Documents\\BIO400Xexperiment\\UNCG_DataWrangling\\SciurusCarolinensisVertNet - SciurusCarolinensisVertNet.csv")
```
\
Now, removal of the columns.
\
```{r}
VertNetNoCol <- subset(SciurusCarolinensisVertNet_SciurusCarolinensisVertNet, select = -c(references, institutioncode, catalognumber, month, day, county, locality, geodeticdatum, coordinateuncertaintyinmeters, georeferencedby, georeferenceddate, georeferenceprotocol, georeferencesources, georeferenceremarks, scientificname, genus, specificepithet, infraspecificepithet, X, X.1))

VertNetNoColNew <- VertNetNoCol[-c(1,1)]
```
\
Once that is done, I also need to isolate my dataset into only those occurences that include all of this information - so any rows containing NAs need to be removed.
\
```{r}
VertNetNoRow <- na.omit(VertNetNoColNew)
```
\
This removes quite a few observations from our dataset, so now we need to make sure that these observations are just within the US. 
\
```{r}
VertNetNoCanada <- VertNetNoRow[VertNetNoRow$country != "Canada", ]
VertNetNoCanada <- VertNetNoCanada[VertNetNoCanada$country != "CANADA", ]
```
\
Now that we have isolated only the observations that are occurring within the United States, we can start having some fun! 

First, let's establish a natural distribution that is mostly unimpacted by the rapid modification of the landscape by human beings. In this instance, we are going to add a new column with two variables - if the observation year is before 1900, then the variable **Established** will be *True*, and if the observation year is after 1900 the variable will be *False*.
\
```{r}
VertNetNaturalDist <- mutate(VertNetNoCanada,
                             Established = decade <= 1900)
```
\
Finally, we need to re-include the variable classifying each observation as West of the Mississippi. 

For this project, as a loose guideline we are going to use the Mississippi as a determinant for a native range and an introduced range. For this, I need to split up any that are coming from the 24 states west of the Mississippi (*Alaska, Arizona, Arkansas, California, Colorado, Hawaii, Idaho, Iowa, Kansas, Louisiana, Minnesota, Missouri, Montana, Nebraska, Nevada, New Mexico, North Dakota, Oklahoma, Oregon, South Dakota, Texas, Utah, Washington, Wyoming*). Some of these will not be included in the dataset (notably, *Hawaii* and *Alaska*) but will be included regardless. 
\
```{r}
WesternStates <- c("Alaska", "Arizona", "Arkansas", "California", "Colorado", "Hawaii", "Idaho", "Iowa", "Kansas", "Louisiana", "Minnesota", "Missouri", "Montana", "Nebraska", "Nevada", "New Mexico", "North Dakota", "Oklahoma", "Oregon", "South Dakota", "Texas", "Utah", "Washington", "Wyoming")

VertNetGrouped <- VertNetNaturalDist %>%
                      mutate(colnamies = str_to_title(stateprovince, locale = "en")) %>%
                      mutate(WestOrNest = ifelse(colnamies %in% WesternStates, "West", "Nest"))
```
\

 
That's all the subsetting we need to do, so the last thing I need to get a complete picture of when and where my squirrels are moving is merge the **WestOrNest** and **Established** columns.
If a squirrel has both *Established(TRUE)* or *Established(FALSE)* and *Nest*, it will be considered **Native**. If a squirrel is *Established(FALSE)* and *West*, it will be considered **Introduced**. If a squirrel is both *Established(TRUE)* and *West*, it will be considered **Moving**. We will call this new column 'Status', and this is what most of our graphs and calculations will be based on.
\
```{r}
library(dplyr)
VertNetFinal <- VertNetGrouped %>%
                    unite(Status, c(Established, WestOrNest), sep = " ", remove = FALSE)

VertNetFinal$Status <- recode(VertNetFinal$Status, "TRUE Nest" = "Native", "FALSE Nest" = "Native", "FALSE West" = "Introduced", "TRUE West" = "Moving")
```
\


## Visual Analysis

Now that everything has been cleaned, filtered, and split to our desired groups of data, we can get into the actual fun part - graphs!

For our first graph, I want to get an idea of how these observations are moving across decades. To do this, I will use the gganimate package to visualize this information across time - using a boxplot with our status on the bottom, with counts on the y-axis.
\
```{r, include=TRUE, warning=FALSE}
library(gganimate)

ggplot(VertNetFinal, aes(factor(Status), fill = Status)) + 
  geom_bar(stat = "count") + 
  transition_states(
    decade,
    transition_length = 2,
    state_length = 1
  ) +
  enter_fade() + 
  exit_shrink() +
  ease_aes('sine-in-out') +
  labs(x = "Population Groups", y = "# of Observations", subtitle = "Currently Showing Decade {closest_state} (cm)", title = "Movement of Grey Squirrels Per Decade Across the US")
```
\

This graph is giving us some interesting information, showing us how our squirrels are still mostly staying within their native ranges, but steadily moving into the western territory in more recent decades.

But how does this compare to how many squirrels there are in each decade? As technology and population of human beings increases, so does the frequency of observation, as well as a population increase for the squirrels as they are allowed into new habitat.

This new, final graph displays how the number of occurrences are changing per decade, and while it may still be biased due to the nature of data collection of this kind and filtering, it gives us a good idea of how these populations are changing over time.
\
```{r, include=TRUE}
ggplot(VertNetFinal, aes(factor(decade), fill = Status)) + 
  geom_bar(stat = "count", position = "stack") +
  labs(x = "Decades", y = "# of Observations", title = "Observations Across Each Decade (US)")
```
\

These graphics are simply one step in the larger scheme of this project, but serve to emphasize that anthropogenic influences can play a massive, and highly tangible, impact on an organism's ability to spread and flourish in environments they would not otherwise be found in.