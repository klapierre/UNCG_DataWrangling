---
title: 'TEMPEST: Understory plant community responses to coastal flooding'
author: "Rachael Brenneman"
date: "`r Sys.Date()`"
output:
  word_document: default
  html_document: default
---

```{r, setup, include=FALSE}
knitr::opts_knit$set(root.dir = "/Users/rachaelbrenneman/Desktop/data_wrangle/UNCG_DataWrangling")
library(tidyverse)
library(dplyr)
library(ggplot2)
```

**Background**:

As climate change continues to intensity, so to do extreme weather events. Heavy rainfall and storm sturges are common and widestream natural weather events to come of this. This leads to many questions, but one major one is: how will sudden deluges impact forests? 

**TEMPEST (Terrestrial Ecosystem Manipulation to Probe the Effects of Storm Treatments)** was designed to investigate this question. Located in the forest at the Smithsonian Environmental Research Center, this experiment mimics intesnse freshwater rainstorms and saltwater storm surges by inundating parts of the forst. 

This data set in particular examines the forest understory communities after these deluge treatments were conducted. Species cover was estimated in 2020 prior to the treatments, to determine whether there were any pre-existing differences between plot. 

To examine this data, first we need to load in the datasheet. 
```{r}
tempest <- read.csv(file = "TEMPEST_SERC_understory sppcomp_2021.csv", stringsAsFactors = F)
```

Now we want to pull out the data that is actually needed for us. 
```{r, results='hide'}
theme_minimal() 
unique(tempest$species) 

only_plant <- tempest %>% 
  filter(!str_detect(species, c('infrastructure'))) %>% 
           filter(!str_detect(species, c('basal'))) %>% 
                    filter(!str_detect(species, c('bare'))) %>% 
  filter(!str_detect(subplot, c('additional')))
  
plant_species <- as.data.frame(unique(only_plant$species)) %>% rename("species" = "unique(only_plant$species)")
```
Next we want to rename some notation and further select out data. 
```{r, results='hide'}
treatment <- only_plant %>% 
  mutate(replicate = paste(plot, subplot, sep="")) %>%
  mutate(plottype = ifelse(plot %in% "C", "Control", plot)) %>% 
  mutate(plottype = ifelse(plot %in% "F", "Freshwater inundation", plottype)) %>% 
  mutate(plottype = ifelse(plot %in% "S", "Saltwater inundation", plottype)) %>% 
  select(-c("project_name":"season")) %>% 
  select(-sampler, -notes, -species, -cover)
```

Now we can calculate the herbaceous plant cover and plant species richness for plot and subplot. 
```{r, results='hide'}
total_herb_cover <- only_plant %>%
  group_by(subplot) %>% 
  mutate(TotalCover = sum(cover)) %>% 
  ungroup() %>% 
  mutate(relativecover = 100*(cover/TotalCover))

subplot_sp_richness <- only_plant %>% 
  group_by(subplot) %>% 
  mutate(subrichness = n_distinct(species)) %>% 
  ungroup()
  
plot_sp_richness <- subplot_sp_richness %>% 
  group_by(plot) %>% 
  mutate(plotrichness = n_distinct(species)) %>% 
  ungroup()
```

Before we can make our figures, we need to find the mean and standard error of subplot species richness for each plot. We can make a function for it. 
```{r, results='hide'}
std.error <- function(x) sd(x)/sqrt(length(x))
   
together_richness_mean <- plot_sp_richness %>% group_by(plot) %>% 
  mutate(meanspeciesrichness = mean(subrichness)) %>% 
  mutate(speciesrichnessSTDERR = std.error(subrichness))

plot_sp_richness_only <- together_richness_mean %>% 
  group_by(plot) %>% 
  summarize(plotrichness = n_distinct(species)) %>%
  ungroup()
```

Now we can make figures. The first will look at richness per plot along with mean and standard error across subplots. The second will show only richness at plot level. 
``` {r}
ggplot(together_richness_mean, aes(x=plot, y=meanspeciesrichness)) +
  geom_bar(stat= "identity") +
  geom_errorbar(aes(ymin = meanspeciesrichness - speciesrichnessSTDERR,
                    ymax = meanspeciesrichness + speciesrichnessSTDERR)) +ylim(0,50) +
  xlab("Plot") +
  ylab("Mean Species Richness")

#2nd figure for richness at plot level
ggplot(plot_sp_richness_only, aes(x=plot, y=plotrichness)) +
  geom_bar(stat= "identity") +
  xlab("Plot") +
  ylab("Plot Richness")
```

Our next figure will be a rank abundance curve for the average understody plant community composition. 
```{r}
relcover <- only_plant %>%
  group_by(plot, species) %>% 
  summarize(average_rel_cov = mean(cover)) %>% 
  ungroup()

species_cover <- relcover %>% 
  group_by(species) %>% 
  summarize(average_rel_cov = mean(average_rel_cov))

cover_ranked <- species_cover %>% 
  arrange(desc(average_rel_cov))

cover_ranked <- cover_ranked %>% 
  mutate(number = 1:91)

ggplot(cover_ranked, aes(x=number, y=average_rel_cov)) +
  geom_point() +
  geom_line() +
  geom_text(aes(label = species)) +
  xlab("Rank") +
  ylab("Avg Relative Cover")
```

Now, we will make a figure with means faceted by species. 
```{r}
relcover_mean <- only_plant %>%
  group_by(plot, species) %>% 
  mutate(average_rel_cov = mean(cover)) %>% 
  mutate(stderror = std.error(cover)) %>% 
  ungroup() 

species_subset <- relcover_mean %>% 
  filter(str_detect(species, c("Berberis thunbergii", "Botrychium dissectum", "Carex sp", "Elaeagnus umbellata", "Epifagus virginiana", "Gallium circaezans", "Ilex opaca", "Lindera benzoin", "Lonicera japonica", "Mitchella repens", "Parthenocissus quinquefolia", "Polygonum virginianum", "Rhus radicans", "Rubus phoenicolasius", "Sceptridium biternatum", "Symphotrichium lateriflorum")))

ggplot(species_subset, aes(x= plot, y=average_rel_cov)) +
  geom_bar(stat="identity") +
  geom_errorbar(aes(ymin = average_rel_cov - stderror,
                    ymax = average_rel_cov + stderror)) +
  facet_wrap(~species, scales = 'free') +
  ylab("Average Relative Cover") +
  xlab("Plot")
```

Looking at our results, at this point in the experiment, there is little difference between the treatment plots. For mean species richness, there is very little difference, whereas in plot richness, it appears that deluge with saltwater has lowered overall richness. Additionally, it appears that mitchella repens followed by carpara bracteata make up most of the cover in the plots. 

Finally, looking at a species basis, there does appear to be some differences in species cover between treatments - especially lindera benzoin and lonicera japonica. 