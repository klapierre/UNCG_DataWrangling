---
title: "Comparing soil nutrients between an annual burned and patch burn grazing system"
author: "Noah Holland"
date: "2023-03-13"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


## Background

The common technique grazing land management in mesic grassland used for cattle, annual burning and grazing (ABG), increases forage production for cattle at the expense of reducing habitat quality for native animals and plants by homogenizing vegetation and removing ground cover of dead plants. However, patch burn grazing (PBG), is a newer land management strategy that focuses on burning shifting patches of land. This leaves unaffected land while still providing recently burned areas that are beneficial for cattle foraging. PBG has been shown to still be just as beneficial for cattle as ABG, while promising to also be better for native wildlife, but evidence is limited for potential benefit of PBG to small animals, microbes, and plantlife. As well, PBG's effect on the soil itself is largely unexplored. 

To explore the effects pf PBG on soil, researchers buried resin bags in various locations in landscapes undergoing ABG and PBG management strategies in order to examine the effects of these strategies on nitrate, ammonium, and phosphorus in the soil between May and August of 2021. 

## Data Tidying

```{r, load_package, message=FALSE, warning=FALSE}
library(tidyverse)
```

```{r getting data}
rawPBGN <- read.csv("PBG_N_compiled_raw_2021.csv", stringsAsFactors = TRUE)
rawPBGP <- read.csv("PBG_P_compiled_raw_2021.csv", stringsAsFactors = TRUE)
rawPBGtrts <- read.csv("PBG_trts.csv", stringsAsFactors = TRUE)
```

```{r combining P and N datasets}
pbgPN <- rbind(rawPBGP, rawPBGN)
```

```{r filtering data for U# by sample}
FilteredUpgbPN <- pbgPN %>% 
  filter(grepl('U', sample))
```

```{r testing for and removing duplicates}
dim(FilteredUpgbPN)
dim(unique(FilteredUpgbPN))
```

```{r Filtering for max dilution by Sample}
maxDilutionPBG <- FilteredUpgbPN %>% 
  group_by(Sample) %>% 
  filter(dilution == max(dilution, na.rm = TRUE)) %>% 
  ungroup()
```

```{r joining PBG data to treatment data}
PNTreatment <- maxDilutionPBG %>% 
  separate(col = Sample, into = c('watershed', 'transect', 'plot', 'elm'), sep = '-') %>% 
  select(-c(elm)) %>% 
  merge(rawPBGtrts) %>% 
  select(c(treatment, watershed, transect, plot, concentration, units, test)) %>% 
  rename(temp = test) %>% 
  mutate(test = ifelse(temp=="HCl PO4_1",
    "Phosphate",ifelse(temp=="KCL NO3_NO2 2", "Nitrate", "Ammonia"
  )))

PNTreatment <- PNTreatment %>% 
  select(-c(temp)) %>% 
  transform(concentration = as.numeric(concentration), plot = as.factor(plot), test = as.factor(test), treatment = as.factor(treatment)) 
  
```

## Graphs

```{r Box Plot}
ggplot(PNTreatment, aes(x=treatment, y=concentration, fill=test), dpi = 500) +
  geom_boxplot(lwd = .5) +
  facet_wrap("test", scales = "free") +
  labs(
    y = "Nutrient Concentration (mgN/L, mg/L)",
    x = "Treatment"
  ) +
  scale_fill_brewer(palette = "Dark2")

```
```{R, Coeficient of Variation}
CV <- PNTreatment %>% 
  group_by(treatment, test) %>% 
  summarise(cv=mean(concentration)/sd(concentration)) %>% 
  ungroup() %>% 
  mutate(nutrient = test) %>% 
  select(-c(test))


ggplot(data = CV, aes(x=nutrient, y=cv, fill=treatment)) +
  geom_col(position = "dodge") +
  labs(
    y="Coefficient of Variation for Concentration 
    (mean/standard deviation)",
    x="Nutrient"
  ) +
  scale_fill_brewer(palette = "Dark2")
```
