---
title: 'TEMPEST: Understory plant community responses to coastal flooding'
author: "Jalyn Bottomley"
date: "2023-03-26"
output: pdf_document
---

```{r setup,include=FALSE}
    knitr::opts_knit$set(root.dir='C:/Users/jhope/OneDrive/Documents/400X coding/UNCG_DataWrangling')
```

Background:
"Storms and heavy rainfall have a huge impact on forests and are necessary for growth of plants. An increase of storms has occurred because of climate change. There is an experimental forest located at the Smithsonian Environmental Research Center in Maryland that is used to test the impacts of increased amounts of storms. The data that has been collected is based on multiple freshwater and saltwater showers to see the impacts on this particular forest."


```{r, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

#setting up R
library(tidyverse)
theme_set(theme_bw())
#Reading in the csv file
tempest <- read.csv('TEMPEST_SERC_understory sppcomp_2021.csv')


#Create data frame with all plant species

Species <- tempest %>% 
  select(species) %>% 
  mutate(species = ifelse(species=="infrastructure cover", NA, ifelse(species==
         "canopy tree basal cover", NA, ifelse(species=="bare ground", NA, species)))) %>% 
  filter(!is.na(species)) %>% 
  distinct(.keep_all = TRUE)
#Create data frame with just treatment information

treatment <- tempest %>% 
  select(plot, subplot) %>% 
  unite(col="replicate",
         c("plot", "subplot"), 
         sep="-",
        remove = FALSE) %>% 
  mutate(type=plot) %>% 
  mutate(type = ifelse(type=="C", "control", ifelse(type == "F", "freshwater inundation", 
                      ifelse(type == "S", "saltwater inundation", type))))
                      
#Calculating the total herbaceous plant cover


total_cover <- tempest %>% 
  mutate(species = ifelse(species=="infrastructure cover", NA, ifelse(species==
         "canopy tree basal cover", NA, ifelse(species=="bare ground", NA, species)))) %>% 
  filter(!is.na(species)) %>% 
  mutate(subplot = ifelse(subplot=="additional", NA, subplot)) %>% 
  filter(!is.na(subplot)) %>% 
  group_by(subplot) %>% 
  summarise(totalPlantCover = sum(cover)) %>% 
  ungroup()
tempest <- merge(x=tempest, y=total_cover, by="subplot", all.x=T) %>% 
  mutate(.data=tempest, relativePlantCover = 100*(cover/totalPlantCover))
#Create data frame including plant richness and caluculation for mean and standard error

plantsr <- tempest %>% 
  group_by(plot, subplot) %>% 
  distinct(across(contains("species")),(.keep_all = TRUE)) %>% 
  summarise(speciesRichness = length(species)) %>% 
  ungroup()
calculationsr <- plantsr %>% 
  group_by(plot) %>% 
  summarise(speciesRichness_mean = mean(speciesRichness), 
            speciesRichness_sd = sd(speciesRichness), 
            speciesRichness_n = length(speciesRichness)) %>% 
  mutate(speciesRichness_se=speciesRichness_sd/sqrt(speciesRichness_n)) %>% 
  ungroup()
srplantcalc <- merge(x=plantsr, 
                                   y=calculationsr, 
                                   by="plot", all.x=T)
  
plotplantsr <- tempest %>% 
  select(plot, subplot, species) %>% 
  group_by(plot) %>% 
  distinct(across(contains("species")), .keep_all = TRUE) %>% 
  summarise(speciesRichness = length(species)) %>% 
  ungroup()

together_richness_mean <- aes(plotplantsr) %>% group_by(plot) %>% 
  mutate(meanspeciesrichness = mean(srplantcalc)) %>%
  

#Making two bar graphs to see species richness

ggplot(data=calculationsr, aes(x=plot, y=meanspeciesrichness, fill=plot))+
  geom_bar(stat="identity")+
  xlab("Plot")+
  ylab("Average Subplot Species Richness")+
  scale_x_discrete(labels=c("C"="Control", "F"="Freshwater Inundation", 
                            "S"="Saltwater Inundation"), limits=c("C", "F", "S"))+
  scale_fill_manual(labels=c("Control", "Freshwater Inundation", "Saltwater Inundation"), 
                    values=c("hotpink", "lightblue", "purple"))+
  theme(legend.position="none")+
  geom_errorbar(aes(ymin=speciesRichness_mean-speciesRichness_se, 
                    ymax=speciesRichness_mean+speciesRichness_se), 
                    position=position_dodge(), width=.3, size=1)+
  expand_limits(y=30)+
  scale_y_continuous(breaks=seq(0, 30, by=5))
ggplot(data=calculationsr, aes(x=plot, y=speciesRichness, fill=plot))+
  geom_bar(stat="identity")+
  xlab("Plot")+
  ylab("Plot Species Richness")+
  scale_x_discrete(labels=c("C"="Control", "F"="Freshwater Inundation", 
                            "S"="Saltwater Inundation"), limits=c("C", "F", "S"))+
  scale_fill_manual(labels=c("Control", "Freshwater Inundation", "Saltwater Inundation"), 
                    values=c("hotpink", "lightblue", "purple"))+
  theme(legend.position="none")+
  expand_limits(y=80)+
  scale_y_continuous(breaks=seq(0, 80, by=10))
```
```{r}
#Create an abundance curve for understory community

ggplot(plotplantsr, aes(x=plot, y=total_cover)) +
  geom_bar(stat= "identity") +
  geom_errorbar(aes(ymin = meanspeciesrichness - speciesrichnessSTDERR,
                    ymax = meanspeciesrichness + speciesrichnessSTDERR)) +ylim(0,50) +
  xlab("Plot") +
  ylab("Mean Species Richness")
#2nd figure for richness at plot level
ggplot(plot_sp_richness_only, aes(x=plot, y=plotrichness)) +
  geom_bar(stat= "identity") +
  xlab("Plot") +
  ylab("Plot Richness")

cover <- only_plant %>%
  group_by(plot, species) %>% 
  summarize(average_rel_cov = mean(cover)) %>% 
  ungroup()
scover <- relcover %>% 
  group_by(species) %>% 
  summarize(average_rel_cov = mean(average_rel_cov))
rcover <- species_cover %>% 
  arrange(desc(average_rel_cov))
rcover <- cover_ranked %>% 
  mutate(number = 1:91)
ggplot(cover_ranked, aes(x=number, y=average_rel_cov)) +
  geom_point() +
  geom_line() +
  geom_text(aes(label = species)) +
  xlab("Rank") +
  ylab("Avg Relative Cover")

#Calculations of mean and standard errer for species relative cover
covermean <- only_plant %>%
  group_by(plot, species) %>% 
  mutate(average_rel_cov = mean(cover)) %>% 
  mutate(stderror = std.error(cover)) %>% 
  ungroup() 
speciessub <- relcover_mean %>% 
  filter(str_detect(species, c("Berberis thunbergii", "Botrychium dissectum", "Carex sp", "Elaeagnus umbellata", "Epifagus virginiana", "Gallium circaezans", "Ilex opaca", "Lindera benzoin", "Lonicera japonica", "Mitchella repens", "Parthenocissus quinquefolia", "Polygonum virginianum", "Rhus radicans", "Rubus phoenicolasius", "Sceptridium biternatum", "Symphotrichium lateriflorum")))
ggplot(species_subset, aes(x= plot, y=average_rel_cov)) +
  geom_bar(stat="identity") +
  geom_errorbar(aes(ymin = average_rel_cov - stderror,
                    ymax = average_rel_cov + stderror)) +
  facet_wrap(~species, scales = 'free') +
  ylab("Average Relative Cover") +
  xlab("Plot")
```
Summary:
"The data was very tidy and clear to understand. The bar graph created helped to see the effects on the forest based on saltwater and freshwater. Overall, there is not a very big difference between the saltwater and freshwater tests based on the figures and the calculations of the mean and standard error.

